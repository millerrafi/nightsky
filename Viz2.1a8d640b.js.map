{"version":3,"sources":["js/three/makeRing.js","node_modules/parcel-bundler/src/builtins/bundle-url.js","node_modules/parcel-bundler/src/builtins/bundle-loader.js","js/three/Viz2.js","node_modules/parcel-bundler/src/builtins/loaders/browser/js-loader.js"],"names":["DEG","Math","PI","makeRing","distance","color","width","front","back","obj","THREE","Object3D","frontMesh","Mesh","SphereGeometry","MeshBasicMaterial","side","FrontSide","opacity","transparent","backMesh","BackSide","add","bundleURL","getBundleURLCached","getBundleURL","Error","err","matches","stack","match","getBaseURL","url","replace","exports","require","loadBundlesLazy","bundles","Array","isArray","id","length","Promise","resolve","code","LazyPromise","reject","loadBundles","slice","then","all","map","loadBundle","bundleLoaders","registerBundleLoader","type","loader","module","load","register","bundle","substring","lastIndexOf","toLowerCase","bundleLoader","resolved","catch","e","executor","promise","prototype","onSuccess","onError","Viz","index","canvas","document","getElementById","container","parentNode","BCR","getBoundingClientRect","WIDTH","HEIGHT","height","ASPECT","renderer","WebGLRenderer","antialias","camera","PerspectiveCamera","position","set","scene","Scene","background","Color","setSize","controls","OrbitControls","enabled","addEventListener","sun","Sprite","SpriteMaterial","TextureLoader","images","depthWrite","scale","SUN_RADIUS","earth","EARTH_RADIUS","northPole","CylinderGeometry","eclipticPlane","EARTH_DISTANCE","PALETTE","ECLIPTIC","moon","MOON_RADIUS","moonOrbit","MOON","moonTilt","rotateOnWorldAxis","Vector3","normalize","ecliptic","EARTH_TILT","light","DirectionalLight","targetObject","target","graticule","material","constellations","equator","EQUATOR","makeStarField","maxSize","dot","scalePoint","mag","exp","fadePoint","update","positions","hide","sunLong","Sun","longitude","moonLong","Moon","visible","orbits","x","sin","z","cos","rotation","y","Earth","rotationAngle","lookAt","rotateY","render","onResize","BCR1","aspect","updateProjectionMatrix","script","createElement","async","charset","src","onerror","onload","getElementsByTagName","appendChild"],"mappings":";AAoDC,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,QAAA,EAAA,IAAA,EAAA,EAAA,QAAA,gDApDD,EAAA,EAAA,QAAA,UAoDC,SAAA,EAAA,GAAA,GAAA,GAAA,EAAA,WAAA,OAAA,EAAA,IAAA,EAAA,GAAA,GAAA,MAAA,EAAA,IAAA,IAAA,KAAA,EAAA,GAAA,OAAA,UAAA,eAAA,KAAA,EAAA,GAAA,CAAA,IAAA,EAAA,OAAA,gBAAA,OAAA,yBAAA,OAAA,yBAAA,EAAA,GAAA,GAAA,EAAA,KAAA,EAAA,IAAA,OAAA,eAAA,EAAA,EAAA,GAAA,EAAA,GAAA,EAAA,GAAA,OAAA,EAAA,QAAA,EAAA,EAAA,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAlDD,IAAMA,EAAMC,KAAKC,GAAK,IAEP,SAASC,EAMrB,GALDC,IAAAA,EAAAA,EAAAA,SACAC,EAAAA,EAAAA,MACAC,EAAAA,EAAAA,MAAAA,OAAQ,IAAA,EAAA,GAAMN,EAGb,EAFDO,EAAAA,EAAAA,MAAAA,OAAQ,IAAA,EAAA,GAEP,EADDC,EAAAA,EAAAA,KAAAA,OAAO,IAAA,EAAA,GACN,EACKC,EAAM,IAAIC,EAAMC,SAEhBC,EAAY,IAAIF,EAAMG,KAC1B,IAAIH,EAAMI,eACRV,EACA,IACA,EACA,EACU,EAAVH,KAAKC,GACLD,KAAKC,GAAK,EAAII,EAAQ,EACtBA,GAEF,IAAII,EAAMK,mBAAV,EAAA,EAAA,SAAA,CACEV,MAAAA,EACAW,KAAMN,EAAMO,UACZC,QAAS,GACTC,aAAa,GACVZ,KAIDa,EAAW,IAAIV,EAAMG,KACzB,IAAIH,EAAMI,eACRV,EACA,IACA,EACA,EACU,EAAVH,KAAKC,GACLD,KAAKC,GAAK,EAAII,EAAQ,EACtBA,GAEF,IAAII,EAAMK,mBAAV,EAAA,EAAA,SAAA,CACEV,MAAAA,EACAW,KAAMN,EAAMW,UACTb,KAMAC,OAFPA,EAAIa,IAAIV,GACRH,EAAIa,IAAIF,GACDX;;AGqIR,aAAA,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IAAA,QAAA,QAAA,EAxLD,IAAA,EAAA,QAAA,mBASA,EAAA,EAAA,QAAA,UACA,EAAA,EAAA,QAAA,uBACA,EAAA,EAAA,QAAA,gCAEA,EAAA,EAAA,QAAA,gCAEA,EAAA,EAAA,QAAA,cACA,EAAA,EAAA,QAAA,kBAwKC,SAAA,EAAA,GAAA,OAAA,GAAA,EAAA,WAAA,EAAA,CAAA,QAAA,GAAA,SAAA,EAAA,GAAA,GAAA,GAAA,EAAA,WAAA,OAAA,EAAA,IAAA,EAAA,GAAA,GAAA,MAAA,EAAA,IAAA,IAAA,KAAA,EAAA,GAAA,OAAA,UAAA,eAAA,KAAA,EAAA,GAAA,CAAA,IAAA,EAAA,OAAA,gBAAA,OAAA,yBAAA,OAAA,yBAAA,EAAA,GAAA,GAAA,EAAA,KAAA,EAAA,IAAA,OAAA,eAAA,EAAA,EAAA,GAAA,EAAA,GAAA,EAAA,GAAA,OAAA,EAAA,QAAA,EAAA,EAtKc,SAASgE,EAAIC,GACpBC,IAAAA,EAASC,SAASC,eAAmBH,IAAAA,OAAAA,IACrCI,EAAYH,EAAOI,WACnBC,EAAMF,EAAUG,wBAGhBC,EAAQF,EAAI1E,MACZ6E,EAASH,EAAII,OAIbC,EAASH,EAAQC,EAMjBG,EAAW,IAAI5E,EAAM6E,cAAc,CACvCC,WAAW,EACXb,OAAQA,IAGJc,EAAS,IAAI/E,EAAMgF,kBAZN,GAYoCL,EAV1C,GACD,KAUZI,EAAOE,SAASC,IAAI,EAAG,IAAK,KACtBC,IAAAA,EAAQ,IAAInF,EAAMoF,MACxBD,EAAME,WAAa,IAAIrF,EAAMsF,MAAM,SACnCH,EAAMvE,IAAImE,GACVH,EAASW,QAAQf,EAAOC,GAEpBe,IAAAA,EAAW,IAAIxF,EAAMyF,cAAcV,EAAQX,GAC/CoB,EAASE,SAAU,EAEnBzB,EAAO0B,iBAAiB,aAAc,WACpCH,EAASE,SAAU,IAGrBzB,EAAO0B,iBAAiB,aAAc,WACpCH,EAASE,SAAU,IAGjBE,IAAAA,EAAM,IAAI5F,EAAM6F,OAClB,IAAI7F,EAAM8F,eAAe,CACvBrD,KAAK,IAAIzC,EAAM+F,eAAgB/C,KAAKgD,EAAO,QAAA,YAC3CC,YAAY,KAGhBL,EAAIM,MAAMhB,IAAiB,EAAbiB,EAAa,WAAgB,EAAbA,EAAa,WAAG,GAC9ChB,EAAMvE,IAAIgF,GAENQ,IAAAA,EAAQ,IAAIpG,EAAMG,KACpB,IAAIH,EAAMI,eAAeiG,EAAzB,aAAuC,GAAI,KAC3C,EAAuBL,EAAAA,SAAAA,EAAO,QAAA,iBAAkBA,EAAO,QAAA,qBAEzDb,EAAMvE,IAAIwF,GAEJE,IAAAA,EAAY,IAAItG,EAAMG,KAC1B,IAAIH,EAAMuG,iBAAiB,GAAK,GAAK,GAAI,GACzC,IAAIvG,EAAMK,kBAAkB,CAAEV,MAAO,YAEvCwF,EAAMvE,IAAI0F,GAENE,IAAAA,GAAgB,EAAS,EAAA,SAAA,CAC3B9G,SAAU+G,EADiB,eAE3B7G,MAAO,EAAIN,EAFgB,IAG3BK,MAAO+G,EAAQC,QAAAA,WAGbC,EAAO,IAAI5G,EAAMG,KACnB,IAAIH,EAAMI,eAA6B,EAAdyG,EAAc,YAAG,GAAI,KAC9C,EAAuBb,EAAAA,SAAAA,EAAO,QAAA,gBAAiBA,EAAO,QAAA,oBAGpDc,GAAY,EAAS,EAAA,SAAA,CACvBpH,SAAU+G,EADa,eAEvB9G,MAAO+G,EAAQK,QAAAA,OAGXC,EAAW,IAAIhH,EAAMC,SAC3B+G,EAASpG,IAAIgG,GACbI,EAASpG,IAAIkG,GAEbE,EAASC,kBAAkB,IAAIjH,EAAMkH,QAAQ,EAAG,EAAG,GAAGC,YAAa,IAAM7H,EAAzE,KAIM8H,IAAAA,EAAW,IAAIpH,EAAMC,SAC3BmH,EAASxG,IAAIgF,GACbwB,EAASxG,IAAIoG,GACbI,EAASxG,IAAI4F,GACbY,EAASH,kBAAkB,IAAIjH,EAAMkH,QAAQ,EAAG,EAAG,IAAKG,EAAD,WAAc/H,EAArE,KACA6F,EAAMvE,IAAIwG,GAENE,IAAAA,EAAQ,IAAItH,EAAMuH,iBAAiB,SAAU,GAC7CC,EAAe,IAAIxH,EAAMC,SAC7BuH,EAAavC,SAASC,IAAI,EAAG,EAAG,GAChCC,EAAMvE,IAAI4G,GAEVF,EAAMG,OAAS7B,EACf0B,EAAMrC,SAASC,IAAI,EAAG,EAAG,GACzBC,EAAMvE,IAAI0G,GAEJI,IAAAA,GAAY,EAAcjB,EAAAA,SAAAA,EAAd,eAA8B,QAAU,CACxDkB,SAAU,CAAEnH,QAAS,MAEvB2E,EAAMvE,IAAI8G,GAEJE,IAAAA,GAAiB,EAAuBnB,EAAAA,SAAAA,EAAvB,gBACvBtB,EAAMvE,IAAIgH,GAENC,IAAAA,GAAU,EAAS,EAAA,SAAA,CACrBnI,SAAU+G,EADW,eAErB7G,MAAO,EAAIN,EAFU,IAGrBK,MAAO+G,EAAQoB,QAAAA,UAkBV,OAfP3C,EAAMvE,IAAIiH,GAEH,QAAA,iBAAA,CAAA,QAAA,QAAA,2BAA0BtF,KAAK,SAAuB,GAApBwF,IAAAA,EAAAA,EAAAA,cACvC5C,EAAMvE,IACJmH,EAActB,EAAD,eAAiB,CAC5BuB,QAAS,EACTC,KAAK,EAELC,WAAY,SAAAC,GAAO,OAAA,EAAI5I,KAAK6I,KAAK,GAAMD,IACvCE,UAAW,SAAAF,GAAO5I,OAAAA,KAAK6I,KAAK,GAAKD,EAAM,UAMtC,CACLG,OAA4B,SAAA,GAAnBC,IAAAA,EAAAA,EAAAA,UAAWC,EAAAA,EAAAA,KACZC,EAAUF,EAAUG,IAAIC,UAAYrJ,EAA1B,IAAgCC,KAAKC,GAC/CoJ,EAAWL,EAAUM,KAAKF,UAAYrJ,EAA3B,IAAiCC,KAAKC,GAEvDoI,EAAekB,SAAWN,EAAKZ,eAC/Bd,EAAUgC,SAAWN,EAAKO,OAC1BvC,EAAcsC,SAAWN,EAAKO,OAC9BrB,EAAUoB,SAAWN,EAAKX,QAC1BA,EAAQiB,SAAWN,EAAKX,QAExBjC,EAAIX,SAAS+D,EAAIvC,EAAiBlH,eAAAA,KAAK0J,IAAIR,GAC3C7C,EAAIX,SAASiE,EAAIzC,EAAiBlH,eAAAA,KAAK4J,IAAIV,GAG3CrC,EAAMgD,SAASC,EAAId,EAAUe,MAAMC,cAAgBjK,EAAhC,IAAgD,GAAVC,KAAKC,GAE9DoH,EAAK3B,SAAS+D,EAAIvC,EAAiBlH,eAAAA,KAAK0J,IAAIL,GAC5ChC,EAAK3B,SAASiE,EAAIzC,EAAiBlH,eAAAA,KAAK4J,IAAIP,GAC5ChC,EAAK4C,OAAOpD,EAAMnB,UAClB2B,EAAK6C,SAASlK,KAAKC,GAAK,GAExBoF,EAAS8E,OAAOvE,EAAOJ,GACvBS,EAAS8C,UAGXqB,SAAW,WACHC,IAAAA,EAAOxF,EAAUG,wBACjBC,EAAQoF,EAAKhK,MACb6E,EAASmF,EAAKlF,OAEpBK,EAAO8E,OAASrF,EAAQC,EACxBM,EAAO+E,yBACPlF,EAASW,QAAQf,EAAOC;;AFrL9B,IAAI5D,EAAY,KAChB,SAASC,IAKAD,OAJFA,IACHA,EAAYE,KAGPF,EAGT,SAASE,IAEH,IACI,MAAA,IAAIC,MACV,MAAOC,GACHC,IAAAA,GAAW,GAAKD,EAAIE,OAAOC,MAAM,iEACjCF,GAAAA,EACKG,OAAAA,EAAWH,EAAQ,IAIvB,MAAA,IAGT,SAASG,EAAWC,GACX,OAAC,GAAKA,GAAKC,QAAQ,wEAAwE,MAAQ,IAG5GC,QAAQT,aAAeD,EACvBU,QAAQH,WAAaA;;AC5BrB,IAAIN,EAAeU,QAAQ,gBAAgBV,aAE3C,SAASW,EAAgBC,GAClBC,MAAMC,QAAQF,KACjBA,EAAU,CAACA,IAGTG,IAAAA,EAAKH,EAAQA,EAAQI,OAAS,GAE9B,IACKC,OAAAA,QAAQC,QAAQR,QAAQK,IAC/B,MAAOb,GACHA,GAAa,qBAAbA,EAAIiB,KACC,OAAA,IAAIC,EAAY,SAAUF,EAASG,GACxCC,EAAYV,EAAQW,MAAM,GAAI,IAC3BC,KAAK,WACGd,OAAAA,QAAQK,KAEhBS,KAAKN,EAASG,KAIfnB,MAAAA,GAIV,SAASoB,EAAYV,GACZK,OAAAA,QAAQQ,IAAIb,EAAQc,IAAIC,IAGjC,IAAIC,EAAgB,GACpB,SAASC,EAAqBC,EAAMC,GAClCH,EAAcE,GAAQC,EAGxBC,OAAOvB,QAAUA,QAAUE,EAC3BF,QAAQwB,KAAOX,EACfb,QAAQyB,SAAWL,EAEnB,IAAIjB,EAAU,GACd,SAASe,EAAWQ,GACdpB,IAAAA,EAMAH,GALAC,MAAMC,QAAQqB,KAChBpB,EAAKoB,EAAO,GACZA,EAASA,EAAO,IAGdvB,EAAQuB,GACHvB,OAAAA,EAAQuB,GAGbL,IAAAA,GAAQK,EAAOC,UAAUD,EAAOE,YAAY,KAAO,EAAGF,EAAOnB,SAAWmB,GAAQG,cAChFC,EAAeX,EAAcE,GAC7BS,OAAAA,EACK3B,EAAQuB,GAAUI,EAAavC,IAAiBmC,GACpDX,KAAK,SAAUgB,GAKPA,OAJHA,GACFR,OAAOG,OAAOD,SAASnB,EAAIyB,GAGtBA,IACNC,MAAM,SAASC,GAGVA,aAFC9B,EAAQuB,GAETO,SAXRH,EAgBN,SAASnB,EAAYuB,GACdA,KAAAA,SAAWA,EACXC,KAAAA,QAAU,KAGjBxB,EAAYyB,UAAUrB,KAAO,SAAUsB,EAAWC,GAEzC,OADc,OAAjB,KAAKH,UAAkB,KAAKA,QAAU,IAAI3B,QAAQ,KAAK0B,WACpD,KAAKC,QAAQpB,KAAKsB,EAAWC,IAGtC3B,EAAYyB,UAAUJ,MAAQ,SAAUM,GAE/B,OADc,OAAjB,KAAKH,UAAkB,KAAKA,QAAU,IAAI3B,QAAQ,KAAK0B,WACpD,KAAKC,QAAQH,MAAMM;;AEjF5Bf,OAAOvB,QAAU,SAAsB0B,GAC9B,OAAA,IAAIlB,QAAQ,SAAUC,EAASG,GAChC2H,IAAAA,EAAS7F,SAAS8F,cAAc,UACpCD,EAAOE,OAAQ,EACfF,EAAOlH,KAAO,kBACdkH,EAAOG,QAAU,QACjBH,EAAOI,IAAMjH,EACb6G,EAAOK,QAAU,SAAU3G,GACzBsG,EAAOK,QAAUL,EAAOM,OAAS,KACjCjI,EAAOqB,IAGTsG,EAAOM,OAAS,WACdN,EAAOK,QAAUL,EAAOM,OAAS,KACjCpI,KAGFiC,SAASoG,qBAAqB,QAAQ,GAAGC,YAAYR","file":"Viz2.1a8d640b.js","sourceRoot":"..","sourcesContent":["import * as THREE from 'three';\r\n\r\nconst DEG = Math.PI / 180;\r\n\r\nexport default function makeRing({\r\n  distance,\r\n  color,\r\n  width = 0.5 * DEG,\r\n  front = {},\r\n  back = {}\r\n}) {\r\n  const obj = new THREE.Object3D();\r\n\r\n  const frontMesh = new THREE.Mesh(\r\n    new THREE.SphereGeometry(\r\n      distance,\r\n      128,\r\n      2,\r\n      0,\r\n      Math.PI * 2,\r\n      Math.PI / 2 - width / 2,\r\n      width\r\n    ),\r\n    new THREE.MeshBasicMaterial({\r\n      color,\r\n      side: THREE.FrontSide,\r\n      opacity: 0.5,\r\n      transparent: true,\r\n      ...front\r\n    })\r\n  );\r\n\r\n  const backMesh = new THREE.Mesh(\r\n    new THREE.SphereGeometry(\r\n      distance,\r\n      128,\r\n      2,\r\n      0,\r\n      Math.PI * 2,\r\n      Math.PI / 2 - width / 2,\r\n      width\r\n    ),\r\n    new THREE.MeshBasicMaterial({\r\n      color,\r\n      side: THREE.BackSide,\r\n      ...back\r\n    })\r\n  );\r\n\r\n  obj.add(frontMesh);\r\n  obj.add(backMesh);\r\n  return obj;\r\n}\r\n","var bundleURL = null;\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  // Attempt to find the URL of the current script and use that as the base URL\n  try {\n    throw new Error;\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\n","var getBundleURL = require('./bundle-url').getBundleURL;\n\nfunction loadBundlesLazy(bundles) {\n  if (!Array.isArray(bundles)) {\n    bundles = [bundles]\n  }\n\n  var id = bundles[bundles.length - 1];\n\n  try {\n    return Promise.resolve(require(id));\n  } catch (err) {\n    if (err.code === 'MODULE_NOT_FOUND') {\n      return new LazyPromise(function (resolve, reject) {\n        loadBundles(bundles.slice(0, -1))\n          .then(function () {\n            return require(id);\n          })\n          .then(resolve, reject);\n      });\n    }\n\n    throw err;\n  }\n}\n\nfunction loadBundles(bundles) {\n  return Promise.all(bundles.map(loadBundle));\n}\n\nvar bundleLoaders = {};\nfunction registerBundleLoader(type, loader) {\n  bundleLoaders[type] = loader;\n}\n\nmodule.exports = exports = loadBundlesLazy;\nexports.load = loadBundles;\nexports.register = registerBundleLoader;\n\nvar bundles = {};\nfunction loadBundle(bundle) {\n  var id;\n  if (Array.isArray(bundle)) {\n    id = bundle[1];\n    bundle = bundle[0];\n  }\n\n  if (bundles[bundle]) {\n    return bundles[bundle];\n  }\n\n  var type = (bundle.substring(bundle.lastIndexOf('.') + 1, bundle.length) || bundle).toLowerCase();\n  var bundleLoader = bundleLoaders[type];\n  if (bundleLoader) {\n    return bundles[bundle] = bundleLoader(getBundleURL() + bundle)\n      .then(function (resolved) {\n        if (resolved) {\n          module.bundle.register(id, resolved);\n        }\n\n        return resolved;\n      }).catch(function(e) {\n        delete bundles[bundle];\n        \n        throw e;\n      });\n  }\n}\n\nfunction LazyPromise(executor) {\n  this.executor = executor;\n  this.promise = null;\n}\n\nLazyPromise.prototype.then = function (onSuccess, onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.then(onSuccess, onError)\n};\n\nLazyPromise.prototype.catch = function (onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.catch(onError)\n};\n","import {\r\n  DEG,\r\n  EARTH_DISTANCE,\r\n  EARTH_RADIUS,\r\n  MOON_RADIUS,\r\n  EARTH_TILT,\r\n  PALETTE,\r\n  SUN_RADIUS\r\n} from '../constants.js';\r\nimport * as THREE from 'three';\r\nimport makeGraticule from '../d3/graticule.js';\r\nimport makeConstellationLines from './makeConstellationLines.js';\r\n// import makeStarField from '/js/three/starField.js';\r\nimport LambertTextureMaterial from './LambertTextureMaterial.js';\r\n\r\nimport images from '../images';\r\nimport makeRing from './makeRing.js';\r\n\r\nexport default function Viz(index) {\r\n  const canvas = document.getElementById(`c${index}`);\r\n  const container = canvas.parentNode;\r\n  const BCR = container.getBoundingClientRect();\r\n\r\n  // Set the scene size.\r\n  const WIDTH = BCR.width;\r\n  const HEIGHT = BCR.height;\r\n\r\n  // Set some camera attributes.\r\n  const VIEW_ANGLE = 15;\r\n  const ASPECT = WIDTH / HEIGHT;\r\n  const NEAR = 0.1;\r\n  const FAR = 10000;\r\n\r\n  // Create a WebGL renderer, camera\r\n  // and a scene\r\n  const renderer = new THREE.WebGLRenderer({\r\n    antialias: true,\r\n    canvas: canvas\r\n  });\r\n\r\n  const camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);\r\n  camera.position.set(0, 150, 400);\r\n  const scene = new THREE.Scene();\r\n  scene.background = new THREE.Color(0x111111);\r\n  scene.add(camera);\r\n  renderer.setSize(WIDTH, HEIGHT);\r\n\r\n  var controls = new THREE.OrbitControls(camera, container);\r\n  controls.enabled = false;\r\n\r\n  canvas.addEventListener('mouseenter', () => {\r\n    controls.enabled = true;\r\n  });\r\n\r\n  canvas.addEventListener('mouseleave', () => {\r\n    controls.enabled = false;\r\n  });\r\n\r\n  var sun = new THREE.Sprite(\r\n    new THREE.SpriteMaterial({\r\n      map: new THREE.TextureLoader().load(images['sun.png']),\r\n      depthWrite: false\r\n    })\r\n  );\r\n  sun.scale.set(SUN_RADIUS * 2, SUN_RADIUS * 2, 1);\r\n  scene.add(sun);\r\n\r\n  var earth = new THREE.Mesh(\r\n    new THREE.SphereGeometry(EARTH_RADIUS, 30, 30),\r\n    LambertTextureMaterial(images['earth-day.jpg'], images['earth-night.jpg'])\r\n  );\r\n  scene.add(earth);\r\n\r\n  const northPole = new THREE.Mesh(\r\n    new THREE.CylinderGeometry(0.1, 0.1, 20, 8),\r\n    new THREE.MeshBasicMaterial({ color: 0xffffff })\r\n  );\r\n  scene.add(northPole);\r\n\r\n  var eclipticPlane = makeRing({\r\n    distance: EARTH_DISTANCE,\r\n    width: 1 * DEG,\r\n    color: PALETTE.ECLIPTIC\r\n  });\r\n\r\n  var moon = new THREE.Mesh(\r\n    new THREE.SphereGeometry(MOON_RADIUS * 2, 30, 30),\r\n    LambertTextureMaterial(images['moon-day.jpg'], images['moon-night.jpg'])\r\n  );\r\n\r\n  var moonOrbit = makeRing({\r\n    distance: EARTH_DISTANCE,\r\n    color: PALETTE.MOON\r\n  });\r\n\r\n  const moonTilt = new THREE.Object3D();\r\n  moonTilt.add(moon);\r\n  moonTilt.add(moonOrbit);\r\n\r\n  moonTilt.rotateOnWorldAxis(new THREE.Vector3(1, 0, 1).normalize(), 5.1 * DEG);\r\n\r\n  // eclipticPlane.rotation.x = Math.PI / 2;\r\n\r\n  const ecliptic = new THREE.Object3D();\r\n  ecliptic.add(sun);\r\n  ecliptic.add(moonTilt);\r\n  ecliptic.add(eclipticPlane);\r\n  ecliptic.rotateOnWorldAxis(new THREE.Vector3(0, 0, 1), -EARTH_TILT * DEG);\r\n  scene.add(ecliptic);\r\n\r\n  var light = new THREE.DirectionalLight(0xffffff, 1);\r\n  var targetObject = new THREE.Object3D();\r\n  targetObject.position.set(0, 0, 0);\r\n  scene.add(targetObject);\r\n\r\n  light.target = sun;\r\n  light.position.set(0, 0, 0);\r\n  scene.add(light);\r\n\r\n  const graticule = makeGraticule(EARTH_DISTANCE, 0x666666, {\r\n    material: { opacity: 0.1 }\r\n  });\r\n  scene.add(graticule);\r\n\r\n  const constellations = makeConstellationLines(EARTH_DISTANCE);\r\n  scene.add(constellations);\r\n\r\n  var equator = makeRing({\r\n    distance: EARTH_DISTANCE,\r\n    width: 2 * DEG,\r\n    color: PALETTE.EQUATOR\r\n  });\r\n\r\n  scene.add(equator);\r\n\r\n  import('/js/three/starField.js').then(({ makeStarField }) => {\r\n    scene.add(\r\n      makeStarField(EARTH_DISTANCE, {\r\n        maxSize: 1,\r\n        dot: true,\r\n        // additive: true,\r\n        scalePoint: mag => 3 * Math.exp(-0.2 * mag),\r\n        fadePoint: mag => Math.exp(-8 * (mag - 2))\r\n        // scalePoint: mag => 2\r\n      })\r\n    );\r\n  });\r\n\r\n  return {\r\n    update({ positions, hide }) {\r\n      const sunLong = positions.Sun.longitude * DEG + Math.PI;\r\n      const moonLong = positions.Moon.longitude * DEG + Math.PI;\r\n\r\n      constellations.visible = !hide.constellations;\r\n      moonOrbit.visible = !hide.orbits;\r\n      eclipticPlane.visible = !hide.orbits;\r\n      graticule.visible = !hide.equator;\r\n      equator.visible = !hide.equator;\r\n\r\n      sun.position.x = EARTH_DISTANCE * Math.sin(sunLong);\r\n      sun.position.z = EARTH_DISTANCE * Math.cos(sunLong);\r\n\r\n      // pi/2 correction for shader texture\r\n      earth.rotation.y = positions.Earth.rotationAngle * DEG + Math.PI * 0.5;\r\n\r\n      moon.position.x = EARTH_DISTANCE * Math.sin(moonLong);\r\n      moon.position.z = EARTH_DISTANCE * Math.cos(moonLong);\r\n      moon.lookAt(earth.position);\r\n      moon.rotateY(-Math.PI / 2);\r\n\r\n      renderer.render(scene, camera);\r\n      controls.update();\r\n    },\r\n\r\n    onResize() {\r\n      const BCR1 = container.getBoundingClientRect();\r\n      const WIDTH = BCR1.width;\r\n      const HEIGHT = BCR1.height;\r\n\r\n      camera.aspect = WIDTH / HEIGHT;\r\n      camera.updateProjectionMatrix();\r\n      renderer.setSize(WIDTH, HEIGHT);\r\n    }\r\n  };\r\n}\r\n","module.exports = function loadJSBundle(bundle) {\n  return new Promise(function (resolve, reject) {\n    var script = document.createElement('script');\n    script.async = true;\n    script.type = 'text/javascript';\n    script.charset = 'utf-8';\n    script.src = bundle;\n    script.onerror = function (e) {\n      script.onerror = script.onload = null;\n      reject(e);\n    };\n\n    script.onload = function () {\n      script.onerror = script.onload = null;\n      resolve();\n    };\n\n    document.getElementsByTagName('head')[0].appendChild(script);\n  });\n};\n"]}