{"version":3,"sources":["js/d3/horizon.js","node_modules/parcel-bundler/src/builtins/bundle-url.js","node_modules/parcel-bundler/src/builtins/bundle-loader.js","js/three/Viz3.js","node_modules/parcel-bundler/src/builtins/loaders/browser/js-loader.js"],"names":["range","makeHorison","radius","mesh","type","coordinates","concat","x","meridian","y","parallel","THREE","LineBasicMaterial","color","PALETTE","HORIZON","opacity","transparent","y0","y1","dy","x0","x1","dx","start","stop","step","i","v","bundleURL","getBundleURLCached","getBundleURL","Error","err","matches","stack","match","getBaseURL","url","replace","exports","require","loadBundlesLazy","bundles","Array","isArray","id","length","Promise","resolve","code","LazyPromise","reject","loadBundles","slice","then","all","map","loadBundle","bundleLoaders","registerBundleLoader","loader","module","load","register","bundle","substring","lastIndexOf","toLowerCase","bundleLoader","resolved","catch","e","executor","promise","prototype","onSuccess","onError","Viz","index","canvas","document","getElementById","container","parentNode","BCR","getBoundingClientRect","WIDTH","width","HEIGHT","height","ASPECT","renderer","WebGLRenderer","antialias","camera","PerspectiveCamera","position","set","scene","Scene","background","Color","add","setSize","controls","OrbitControls","enabled","addEventListener","celestialSphere","Object3D","ground","Mesh","CircleGeometry","EARTH_DISTANCE","MeshBasicMaterial","renderOrder","rotation","Math","PI","underground","clone","material","blending","additiveBlending","sunMap","TextureLoader","images","sunMaterial","SpriteMaterial","depthWrite","sun","Sprite","scale","SUN_RADIUS","eclipticPlane","TorusGeometry","ECLIPTIC","side","DoubleSide","moon","SphereGeometry","MOON_RADIUS","moonOrbit","MOON","moonTilt","rotateOnWorldAxis","Vector3","normalize","DEG","ecliptic","EARTH_TILT","light","DirectionalLight","targetObject","target","graticule","constellations","equator","EQUATOR","horizon","northSouth","CylinderGeometry","eastWest","z","observer","makeStarField","starField","maxSize","dot","additive","scalePoint","mag","exp","update","positions","hide","location","sunLong","Sun","longitude","moonLong","Moon","visible","orbits","sin","cos","lat","long","Earth","rotationAngle","lookAt","rotateY","render","onResize","BCR1","aspect","updateProjectionMatrix","script","createElement","async","charset","src","onerror","onload","getElementsByTagName","appendChild"],"mappings":"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","file":"Viz3.91ae0818.js","sourceRoot":"..","sourcesContent":["// https://observablehq.com/@mbostock/geojson-in-three-js\r\nimport wireframe from './wireframe.js';\r\nimport { PALETTE } from '../constants.js';\r\nimport * as THREE from 'three';\r\n\r\nexport default function makeHorison(radius) {\r\n  const mesh = {\r\n    type: 'MultiLineString',\r\n    coordinates: [].concat(\r\n      Array.from(range(-180, 180, 90), x =>\r\n        x % 90 ? meridian(x, -60, 60) : meridian(x, 0, 90)\r\n      ),\r\n      Array.from(range(0, 90 + 1e-6, 90), y => parallel(y, -180, 180))\r\n    )\r\n  };\r\n\r\n  return wireframe(\r\n    mesh,\r\n    radius,\r\n    new THREE.LineBasicMaterial({\r\n      color: PALETTE.HORIZON,\r\n      opacity: 1,\r\n      transparent: true\r\n    })\r\n  );\r\n}\r\n\r\nfunction meridian(x, y0, y1, dy = 2.5) {\r\n  return Array.from(range(y0, y1 + 1e-6, dy), y => [x, y]);\r\n}\r\n\r\nfunction parallel(y, x0, x1, dx = 2.5) {\r\n  return Array.from(range(x0, x1 + 1e-6, dx), x => [x, y]);\r\n}\r\n\r\nfunction* range(start, stop, step) {\r\n  for (let i = 0, v = start; v < stop; v = start + ++i * step) {\r\n    yield v;\r\n  }\r\n}\r\n","var bundleURL = null;\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  // Attempt to find the URL of the current script and use that as the base URL\n  try {\n    throw new Error;\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\\/\\/.+)\\/[^/]+$/, '$1') + '/';\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\n","var getBundleURL = require('./bundle-url').getBundleURL;\n\nfunction loadBundlesLazy(bundles) {\n  if (!Array.isArray(bundles)) {\n    bundles = [bundles]\n  }\n\n  var id = bundles[bundles.length - 1];\n\n  try {\n    return Promise.resolve(require(id));\n  } catch (err) {\n    if (err.code === 'MODULE_NOT_FOUND') {\n      return new LazyPromise(function (resolve, reject) {\n        loadBundles(bundles.slice(0, -1))\n          .then(function () {\n            return require(id);\n          })\n          .then(resolve, reject);\n      });\n    }\n\n    throw err;\n  }\n}\n\nfunction loadBundles(bundles) {\n  return Promise.all(bundles.map(loadBundle));\n}\n\nvar bundleLoaders = {};\nfunction registerBundleLoader(type, loader) {\n  bundleLoaders[type] = loader;\n}\n\nmodule.exports = exports = loadBundlesLazy;\nexports.load = loadBundles;\nexports.register = registerBundleLoader;\n\nvar bundles = {};\nfunction loadBundle(bundle) {\n  var id;\n  if (Array.isArray(bundle)) {\n    id = bundle[1];\n    bundle = bundle[0];\n  }\n\n  if (bundles[bundle]) {\n    return bundles[bundle];\n  }\n\n  var type = (bundle.substring(bundle.lastIndexOf('.') + 1, bundle.length) || bundle).toLowerCase();\n  var bundleLoader = bundleLoaders[type];\n  if (bundleLoader) {\n    return bundles[bundle] = bundleLoader(getBundleURL() + bundle)\n      .then(function (resolved) {\n        if (resolved) {\n          module.bundle.register(id, resolved);\n        }\n\n        return resolved;\n      }).catch(function(e) {\n        delete bundles[bundle];\n        \n        throw e;\n      });\n  }\n}\n\nfunction LazyPromise(executor) {\n  this.executor = executor;\n  this.promise = null;\n}\n\nLazyPromise.prototype.then = function (onSuccess, onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.then(onSuccess, onError)\n};\n\nLazyPromise.prototype.catch = function (onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.catch(onError)\n};\n","import {\r\n  DEG,\r\n  EARTH_DISTANCE,\r\n  EARTH_TILT,\r\n  MOON_RADIUS,\r\n  SUN_RADIUS,\r\n  PALETTE\r\n} from '../constants.js';\r\nimport * as THREE from 'three';\r\nimport makeGraticule from '../d3/graticule.js';\r\nimport makeHorizon from '../d3/horizon.js';\r\nimport makeConstellationLines from './makeConstellationLines.js';\r\n// import makeStarField from '/js/three/starField.js';\r\nimport LambertTextureMaterial from './LambertTextureMaterial.js';\r\n\r\nimport images from '../images';\r\n\r\nexport default function Viz(index) {\r\n  const canvas = document.getElementById(`c${index}`);\r\n  const container = canvas.parentNode;\r\n  const BCR = container.getBoundingClientRect();\r\n\r\n  // Set the scene size.\r\n  const WIDTH = BCR.width;\r\n  const HEIGHT = BCR.height;\r\n\r\n  // coordsInput.\r\n\r\n  // Set some camera attributes.\r\n  const VIEW_ANGLE = 15;\r\n  const ASPECT = WIDTH / HEIGHT;\r\n  const NEAR = 0.1;\r\n  const FAR = 10000;\r\n\r\n  const renderer = new THREE.WebGLRenderer({\r\n    antialias: true,\r\n    canvas: canvas\r\n  });\r\n\r\n  const camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);\r\n  camera.position.set(200, 150, 200);\r\n  const scene = new THREE.Scene();\r\n  scene.background = new THREE.Color(0x111111);\r\n  scene.add(camera);\r\n  renderer.setSize(WIDTH, HEIGHT);\r\n\r\n  var controls = new THREE.OrbitControls(camera, container);\r\n  controls.enabled = false;\r\n  canvas.addEventListener('mouseenter', () => {\r\n    controls.enabled = true;\r\n  });\r\n  canvas.addEventListener('mouseleave', () => {\r\n    controls.enabled = false;\r\n  });\r\n\r\n  const celestialSphere = new THREE.Object3D();\r\n\r\n  var ground = new THREE.Mesh(\r\n    new THREE.CircleGeometry(EARTH_DISTANCE, 64),\r\n    new THREE.MeshBasicMaterial({\r\n      color: 0xaa0000,\r\n      // color: PALETTE.GROUND,\r\n      transparent: true,\r\n      opacity: 0.6\r\n    })\r\n  );\r\n\r\n  scene.add(ground);\r\n  ground.renderOrder = 1;\r\n  ground.rotation.x = -Math.PI / 2;\r\n\r\n  const underground = ground.clone();\r\n\r\n  underground.material = new THREE.MeshBasicMaterial({\r\n    color: 0xaa0000,\r\n    // color: PALETTE.GROUND,\r\n    blending: THREE.additiveBlending,\r\n    transparent: true,\r\n    opacity: 0.2\r\n  });\r\n\r\n  underground.rotation.x = Math.PI / 2;\r\n  underground.renderOrder = 1;\r\n  scene.add(underground);\r\n\r\n  var sunMap = new THREE.TextureLoader().load(images['sun.png']);\r\n  var sunMaterial = new THREE.SpriteMaterial({\r\n    map: sunMap,\r\n    depthWrite: false\r\n  });\r\n  var sun = new THREE.Sprite(sunMaterial);\r\n  sun.scale.set(SUN_RADIUS * 2, SUN_RADIUS * 2, 1);\r\n  celestialSphere.add(sun);\r\n\r\n  var eclipticPlane = new THREE.Mesh(\r\n    new THREE.TorusGeometry(EARTH_DISTANCE, 0.1, 16, 100),\r\n    new THREE.MeshBasicMaterial({\r\n      color: PALETTE.ECLIPTIC,\r\n      side: THREE.DoubleSide\r\n    })\r\n  );\r\n\r\n  eclipticPlane.rotation.x = Math.PI / 2;\r\n  // celestialSphere.add(mesh);\r\n\r\n  var moon = new THREE.Mesh(\r\n    new THREE.SphereGeometry(MOON_RADIUS * 2, 30, 30),\r\n    LambertTextureMaterial(images['moon-day.jpg'], images['moon-night.jpg'])\r\n  );\r\n\r\n  var moonOrbit = new THREE.Mesh(\r\n    new THREE.TorusGeometry(EARTH_DISTANCE, 0.1, 16, 100),\r\n    new THREE.MeshBasicMaterial({\r\n      color: PALETTE.MOON\r\n      // side: THREE.DoubleSide\r\n    })\r\n  );\r\n  moonOrbit.rotation.x = Math.PI / 2;\r\n\r\n  const moonTilt = new THREE.Object3D();\r\n  moonTilt.add(moon);\r\n  moonTilt.add(moonOrbit);\r\n\r\n  moonTilt.rotateOnWorldAxis(new THREE.Vector3(1, 0, 1).normalize(), 5.1 * DEG);\r\n\r\n  eclipticPlane.rotation.x = Math.PI / 2;\r\n\r\n  const ecliptic = new THREE.Object3D();\r\n  ecliptic.add(sun);\r\n  ecliptic.add(moonTilt);\r\n  ecliptic.add(eclipticPlane);\r\n  ecliptic.rotateOnWorldAxis(new THREE.Vector3(0, 0, 1), -EARTH_TILT * DEG);\r\n  celestialSphere.add(ecliptic);\r\n\r\n  var light = new THREE.DirectionalLight(0xffffff, 1);\r\n  var targetObject = new THREE.Object3D();\r\n  targetObject.position.set(0, 0, 0);\r\n  celestialSphere.add(targetObject);\r\n\r\n  light.target = sun;\r\n  light.position.set(0, 0, 0);\r\n  celestialSphere.add(light);\r\n\r\n  const graticule = makeGraticule(EARTH_DISTANCE);\r\n  celestialSphere.add(graticule);\r\n\r\n  const constellations = makeConstellationLines(EARTH_DISTANCE);\r\n  celestialSphere.add(constellations);\r\n\r\n  var equator = new THREE.Mesh(\r\n    new THREE.TorusGeometry(EARTH_DISTANCE, 0.2, 16, 100),\r\n    new THREE.MeshBasicMaterial({\r\n      color: PALETTE.EQUATOR,\r\n      side: THREE.DoubleSide,\r\n      transparent: true,\r\n      opacity: 0.9\r\n    })\r\n  );\r\n  equator.rotation.x = Math.PI / 2;\r\n  celestialSphere.add(equator);\r\n\r\n  scene.add(celestialSphere);\r\n\r\n  const horizon = makeHorizon(EARTH_DISTANCE);\r\n  scene.add(horizon);\r\n\r\n  const northSouth = new THREE.Mesh(\r\n    new THREE.CylinderGeometry(0.1, 0.1, EARTH_DISTANCE * 2, 8),\r\n    new THREE.MeshBasicMaterial({ color: PALETTE.HORIZON })\r\n  );\r\n\r\n  northSouth.rotation.x = Math.PI / 2;\r\n\r\n  scene.add(northSouth);\r\n\r\n  const eastWest = new THREE.Mesh(\r\n    new THREE.CylinderGeometry(0.1, 0.1, EARTH_DISTANCE * 2, 8),\r\n    new THREE.MeshBasicMaterial({ color: PALETTE.HORIZON })\r\n  );\r\n\r\n  eastWest.rotation.z = Math.PI / 2;\r\n\r\n  scene.add(eastWest);\r\n\r\n  const height = 10;\r\n\r\n  const observer = new THREE.Mesh(\r\n    new THREE.CylinderGeometry(0.5, 0.5, height, 8),\r\n    new THREE.MeshBasicMaterial({ color: PALETTE.HORIZON })\r\n  );\r\n\r\n  observer.position.set(0, height / 2, 0);\r\n\r\n  scene.add(observer);\r\n\r\n  import('/js/three/starField.js').then(({ makeStarField }) => {\r\n    const starField = makeStarField(EARTH_DISTANCE, {\r\n      maxSize: 1,\r\n      dot: true,\r\n      additive: true,\r\n      scalePoint: mag => 3 * Math.exp(-0.2 * mag)\r\n    });\r\n    celestialSphere.add(starField);\r\n  });\r\n\r\n  // celestialSphere.add(makeStarField(EARTH_DISTANCE));\r\n\r\n  return {\r\n    update({ positions, hide, location }) {\r\n      const sunLong = positions.Sun.longitude * DEG + Math.PI;\r\n      const moonLong = positions.Moon.longitude * DEG + Math.PI;\r\n\r\n      constellations.visible = !hide.constellations;\r\n      moonOrbit.visible = !hide.orbits;\r\n      eclipticPlane.visible = !hide.orbits;\r\n      graticule.visible = !hide.equator;\r\n      equator.visible = !hide.equator;\r\n      horizon.visible = !hide.horizon;\r\n\r\n      sun.position.x = EARTH_DISTANCE * Math.sin(sunLong);\r\n      sun.position.z = EARTH_DISTANCE * Math.cos(sunLong);\r\n\r\n      celestialSphere.rotation.x = (90 - location.lat) * DEG;\r\n      celestialSphere.rotation.y =\r\n        -location.long * DEG - positions.Earth.rotationAngle * DEG;\r\n\r\n      moon.position.x = EARTH_DISTANCE * Math.sin(moonLong);\r\n      moon.position.z = EARTH_DISTANCE * Math.cos(moonLong);\r\n      moon.lookAt(ground.position);\r\n      moon.rotateY(-Math.PI / 2);\r\n\r\n      renderer.render(scene, camera);\r\n      controls.update();\r\n    },\r\n\r\n    onResize() {\r\n      const BCR1 = container.getBoundingClientRect();\r\n      const WIDTH = BCR1.width;\r\n      const HEIGHT = BCR1.height;\r\n\r\n      camera.aspect = WIDTH / HEIGHT;\r\n      camera.updateProjectionMatrix();\r\n      renderer.setSize(WIDTH, HEIGHT);\r\n    }\r\n  };\r\n}\r\n","module.exports = function loadJSBundle(bundle) {\n  return new Promise(function (resolve, reject) {\n    var script = document.createElement('script');\n    script.async = true;\n    script.type = 'text/javascript';\n    script.charset = 'utf-8';\n    script.src = bundle;\n    script.onerror = function (e) {\n      script.onerror = script.onload = null;\n      reject(e);\n    };\n\n    script.onload = function () {\n      script.onerror = script.onload = null;\n      resolve();\n    };\n\n    document.getElementsByTagName('head')[0].appendChild(script);\n  });\n};\n"]}