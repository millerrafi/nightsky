import moonPosition from '../js/astro/moon.js';
import './toBeCyclicallyCloseTo.js';

/**
 * Astronomy data sources:
 * https://eclipse.gsfc.nasa.gov/LEcat5/LE2001-2100.html
 * https://eclipse.gsfc.nasa.gov/SEcat5/SE2001-2100.html
 */

describe('moon', () => {
  describe('at synodic angle of 180° at total lunar eclipse', () => {
    test.each`
      date            | time          | expected
      ${'2001-01-09'} | ${'20:21:40'} | ${180}
      ${'2003-05-16'} | ${'03:41:13'} | ${180}
      ${'2003-11-09'} | ${'01:19:38'} | ${180}
      ${'2004-05-04'} | ${'20:31:17'} | ${180}
      ${'2004-10-28'} | ${'03:05:11'} | ${180}
      ${'2007-03-03'} | ${'23:21:59'} | ${180}
      ${'2007-08-28'} | ${'10:38:27'} | ${180}
      ${'2008-02-21'} | ${'03:27:09'} | ${180}
      ${'2010-12-21'} | ${'08:18:04'} | ${180}
      ${'2011-06-15'} | ${'20:13:43'} | ${180}
      ${'2011-12-10'} | ${'14:32:56'} | ${180}
      ${'2014-04-15'} | ${'07:46:48'} | ${180}
      ${'2014-10-08'} | ${'10:55:44'} | ${180}
      ${'2015-04-04'} | ${'12:01:24'} | ${180}
      ${'2015-09-28'} | ${'02:48:17'} | ${180}
      ${'2018-01-31'} | ${'13:31:00'} | ${180}
      ${'2018-07-27'} | ${'20:22:54'} | ${180}
      ${'2019-01-21'} | ${'05:13:27'} | ${180}
      ${'2021-05-26'} | ${'11:19:53'} | ${180}
      ${'2022-05-16'} | ${'04:12:42'} | ${180}
    `('on $date', ({ date, time, expected }) => {
      expect(
        moonPosition(new Date(`${date}Z${time}`)).synF
      ).toBeCyclicallyCloseTo(expected / 360, 1);
    });
  });

  describe('at draconic angle of 0° or 180° at total lunar eclipse', () => {
    test.each`
      date            | time          | expected
      ${'2001-01-09'} | ${'20:21:40'} | ${0}
      ${'2003-11-09'} | ${'01:19:38'} | ${0}
      ${'2004-10-28'} | ${'03:05:11'} | ${0}
      ${'2007-08-28'} | ${'10:38:27'} | ${0}
      ${'2011-06-15'} | ${'20:13:43'} | ${0}
      ${'2014-04-15'} | ${'07:46:48'} | ${0}
      ${'2015-04-04'} | ${'12:01:24'} | ${0}
      ${'2018-01-31'} | ${'13:31:00'} | ${0}
      ${'2019-01-21'} | ${'05:13:27'} | ${0}
      ${'2003-05-16'} | ${'03:41:13'} | ${180}
      ${'2004-05-04'} | ${'20:31:17'} | ${180}
      ${'2007-03-03'} | ${'23:21:59'} | ${180}
      ${'2008-02-21'} | ${'03:27:09'} | ${180}
      ${'2010-12-21'} | ${'08:18:04'} | ${180}
      ${'2011-12-10'} | ${'14:32:56'} | ${180}
      ${'2014-10-08'} | ${'10:55:44'} | ${180}
      ${'2015-09-28'} | ${'02:48:17'} | ${180}
      ${'2018-07-27'} | ${'20:22:54'} | ${180}
      ${'2021-05-26'} | ${'11:19:53'} | ${180}
      ${'2022-05-16'} | ${'04:12:42'} | ${180}
    `('on $date', ({ date, time, expected }) => {
      expect(
        moonPosition(new Date(`${date}Z${time}`)).dracF
      ).toBeCyclicallyCloseTo(expected / 360, 1);
    });
  });

  describe('at synodic fraction of 0° at total or annular solar eclipse', () => {
    test.each`
      date            | time          | expected
      ${'2001-06-21'} | ${'12:04:46'} | ${0.0}
      ${'2001-12-14'} | ${'20:53:01'} | ${0.0}
      ${'2002-06-10'} | ${'23:45:22'} | ${0.0}
      ${'2002-12-04'} | ${'07:32:16'} | ${0.0}
      ${'2003-11-23'} | ${'22:50:22'} | ${0.0}
      ${'2005-10-03'} | ${'10:32:47'} | ${0.0}
      ${'2006-03-29'} | ${'10:12:23'} | ${0.0}
      ${'2006-09-22'} | ${'11:41:16'} | ${0.0}
      ${'2008-02-07'} | ${'03:56:10'} | ${0.0}
      ${'2008-08-01'} | ${'10:22:12'} | ${0.0}
      ${'2009-01-26'} | ${'07:59:45'} | ${0.0}
      ${'2009-07-22'} | ${'02:36:25'} | ${0.0}
      ${'2010-01-15'} | ${'07:07:39'} | ${0.0}
      ${'2010-07-11'} | ${'19:34:38'} | ${0.0}
      ${'2012-05-20'} | ${'23:53:54'} | ${0.0}
      ${'2012-11-13'} | ${'22:12:55'} | ${0.0}
      ${'2013-05-10'} | ${'00:26:20'} | ${0.0}
      ${'2015-03-20'} | ${'09:46:47'} | ${0.0}
      ${'2016-03-09'} | ${'01:58:19'} | ${0.0}
      ${'2016-09-01'} | ${'09:08:02'} | ${0.0}
      ${'2017-02-26'} | ${'14:54:33'} | ${0.0}
      ${'2017-08-21'} | ${'18:26:40'} | ${0.0}
      ${'2019-07-02'} | ${'19:24:07'} | ${0.0}
      ${'2019-12-26'} | ${'05:18:53'} | ${0.0}
      ${'2020-12-14'} | ${'16:14:39'} | ${0.0}
      ${'2021-06-10'} | ${'10:43:07'} | ${0.0}
      ${'2021-12-04'} | ${'07:34:38'} | ${0.0}
      ${'2023-10-14'} | ${'18:00:41'} | ${0.0}
    `('on $date', ({ date, time, expected }) => {
      expect(
        moonPosition(new Date(`${date}Z${time}`)).synF
      ).toBeCyclicallyCloseTo(expected / 360, 1);
    });
  });

  describe('at draconic fraction of 0° or 180° at total or annular solar eclipse', () => {
    test.each`
      date            | time          | expected
      ${'2001-06-21'} | ${'12:04:46'} | ${0}
      ${'2001-12-14'} | ${'20:53:01'} | ${180}
      ${'2002-06-10'} | ${'23:45:22'} | ${0}
      ${'2002-12-04'} | ${'07:32:16'} | ${180}
      ${'2003-11-23'} | ${'22:50:22'} | ${180}
      ${'2005-10-03'} | ${'10:32:47'} | ${180}
      ${'2006-03-29'} | ${'10:12:23'} | ${0}
      ${'2006-09-22'} | ${'11:41:16'} | ${180}
      ${'2008-02-07'} | ${'03:56:10'} | ${0}
      ${'2008-08-01'} | ${'10:22:12'} | ${180}
      ${'2009-01-26'} | ${'07:59:45'} | ${0}
      ${'2009-07-22'} | ${'02:36:25'} | ${180}
      ${'2010-01-15'} | ${'07:07:39'} | ${0}
      ${'2010-07-11'} | ${'19:34:38'} | ${180}
      ${'2012-05-20'} | ${'23:53:54'} | ${180}
      ${'2012-11-13'} | ${'22:12:55'} | ${0}
      ${'2013-05-10'} | ${'00:26:20'} | ${180}
      ${'2015-03-20'} | ${'09:46:47'} | ${180}
      ${'2016-03-09'} | ${'01:58:19'} | ${180}
      ${'2016-09-01'} | ${'09:08:02'} | ${0}
      ${'2017-02-26'} | ${'14:54:33'} | ${180}
      ${'2017-08-21'} | ${'18:26:40'} | ${0}
      ${'2019-07-02'} | ${'19:24:07'} | ${0}
      ${'2019-12-26'} | ${'05:18:53'} | ${180}
      ${'2020-12-14'} | ${'16:14:39'} | ${180}
      ${'2021-06-10'} | ${'10:43:07'} | ${0}
      ${'2021-12-04'} | ${'07:34:38'} | ${180}
      ${'2023-10-14'} | ${'18:00:41'} | ${180}
    `('on $date', ({ date, time, expected }) => {
      expect(
        moonPosition(new Date(`${date}Z${time}`)).dracF
      ).toBeCyclicallyCloseTo(expected / 360, 1);
    });
  });
});
