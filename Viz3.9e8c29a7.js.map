{"version":3,"sources":["js/d3/horizon.js","js/three/Viz3.js"],"names":["range","makeHorison","radius","mesh","type","coordinates","concat","x","meridian","y","parallel","THREE","LineBasicMaterial","color","PALETTE","HORIZON","opacity","transparent","y0","y1","dy","x0","x1","dx","start","stop","step","i","v","Viz","index","canvas","document","getElementById","container","parentNode","BCR","getBoundingClientRect","WIDTH","width","HEIGHT","height","VIEW_ANGLE","ASPECT","NEAR","FAR","renderer","WebGLRenderer","antialias","camera","PerspectiveCamera","position","set","scene","Scene","background","Color","add","setSize","controls","OrbitControls","enabled","addEventListener","celestialSphere","Object3D","ground","Mesh","CircleGeometry","EARTH_DISTANCE","MeshBasicMaterial","renderOrder","rotation","Math","PI","underground","clone","material","blending","additiveBlending","sunMap","TextureLoader","load","images","sunMaterial","SpriteMaterial","map","depthWrite","sun","Sprite","scale","SUN_RADIUS","eclipticPlane","TorusGeometry","ECLIPTIC","side","DoubleSide","moon","SphereGeometry","MOON_RADIUS","moonOrbit","MOON","moonTilt","rotateOnWorldAxis","Vector3","normalize","DEG","ecliptic","EARTH_TILT","light","DirectionalLight","targetObject","target","graticule","constellations","equator","EQUATOR","horizon","northSouth","CylinderGeometry","eastWest","z","observer","then","makeStarField","starField","maxSize","dot","additive","scalePoint","mag","exp","update","positions","hide","location","sunLong","Sun","longitude","moonLong","Moon","visible","orbits","sin","cos","lat","long","Earth","rotationAngle","lookAt","rotateY","render","onResize","BCR1","aspect","updateProjectionMatrix"],"mappings":"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","file":"Viz3.9e8c29a7.js","sourceRoot":"..","sourcesContent":["// https://observablehq.com/@mbostock/geojson-in-three-js\r\nimport wireframe from './wireframe.js';\r\nimport { PALETTE } from '../constants.js';\r\nimport * as THREE from 'three';\r\n\r\nexport default function makeHorison(radius) {\r\n  const mesh = {\r\n    type: 'MultiLineString',\r\n    coordinates: [].concat(\r\n      Array.from(range(-180, 180, 90), x =>\r\n        x % 90 ? meridian(x, -60, 60) : meridian(x, 0, 90)\r\n      ),\r\n      Array.from(range(0, 90 + 1e-6, 90), y => parallel(y, -180, 180))\r\n    )\r\n  };\r\n\r\n  return wireframe(\r\n    mesh,\r\n    radius,\r\n    new THREE.LineBasicMaterial({\r\n      color: PALETTE.HORIZON,\r\n      opacity: 1,\r\n      transparent: true\r\n    })\r\n  );\r\n}\r\n\r\nfunction meridian(x, y0, y1, dy = 2.5) {\r\n  return Array.from(range(y0, y1 + 1e-6, dy), y => [x, y]);\r\n}\r\n\r\nfunction parallel(y, x0, x1, dx = 2.5) {\r\n  return Array.from(range(x0, x1 + 1e-6, dx), x => [x, y]);\r\n}\r\n\r\nfunction* range(start, stop, step) {\r\n  for (let i = 0, v = start; v < stop; v = start + ++i * step) {\r\n    yield v;\r\n  }\r\n}\r\n","import {\r\n  DEG,\r\n  EARTH_DISTANCE,\r\n  EARTH_TILT,\r\n  MOON_RADIUS,\r\n  SUN_RADIUS,\r\n  PALETTE\r\n} from '../constants.js';\r\nimport * as THREE from 'three';\r\nimport makeGraticule from '../d3/graticule.js';\r\nimport makeHorizon from '../d3/horizon.js';\r\nimport makeConstellationLines from './makeConstellationLines.js';\r\n// import makeStarField from '/js/three/starField.js';\r\nimport LambertTextureMaterial from './LambertTextureMaterial.js';\r\n\r\nimport images from '../images';\r\n\r\nexport default function Viz(index) {\r\n  const canvas = document.getElementById(`c${index}`);\r\n  const container = canvas.parentNode;\r\n  const BCR = container.getBoundingClientRect();\r\n\r\n  // Set the scene size.\r\n  const WIDTH = BCR.width;\r\n  const HEIGHT = BCR.height;\r\n\r\n  // coordsInput.\r\n\r\n  // Set some camera attributes.\r\n  const VIEW_ANGLE = 15;\r\n  const ASPECT = WIDTH / HEIGHT;\r\n  const NEAR = 0.1;\r\n  const FAR = 10000;\r\n\r\n  const renderer = new THREE.WebGLRenderer({\r\n    antialias: true,\r\n    canvas: canvas\r\n  });\r\n\r\n  const camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);\r\n  camera.position.set(200, 150, 200);\r\n  const scene = new THREE.Scene();\r\n  scene.background = new THREE.Color(0x111111);\r\n  scene.add(camera);\r\n  renderer.setSize(WIDTH, HEIGHT);\r\n\r\n  var controls = new THREE.OrbitControls(camera, container);\r\n  controls.enabled = false;\r\n  canvas.addEventListener('mouseenter', () => {\r\n    controls.enabled = true;\r\n  });\r\n  canvas.addEventListener('mouseleave', () => {\r\n    controls.enabled = false;\r\n  });\r\n\r\n  const celestialSphere = new THREE.Object3D();\r\n\r\n  var ground = new THREE.Mesh(\r\n    new THREE.CircleGeometry(EARTH_DISTANCE, 64),\r\n    new THREE.MeshBasicMaterial({\r\n      color: 0xaa0000,\r\n      // color: PALETTE.GROUND,\r\n      transparent: true,\r\n      opacity: 0.6\r\n    })\r\n  );\r\n\r\n  scene.add(ground);\r\n  ground.renderOrder = 1;\r\n  ground.rotation.x = -Math.PI / 2;\r\n\r\n  const underground = ground.clone();\r\n\r\n  underground.material = new THREE.MeshBasicMaterial({\r\n    color: 0xaa0000,\r\n    // color: PALETTE.GROUND,\r\n    blending: THREE.additiveBlending,\r\n    transparent: true,\r\n    opacity: 0.2\r\n  });\r\n\r\n  underground.rotation.x = Math.PI / 2;\r\n  underground.renderOrder = 1;\r\n  scene.add(underground);\r\n\r\n  var sunMap = new THREE.TextureLoader().load(images['sun.png']);\r\n  var sunMaterial = new THREE.SpriteMaterial({\r\n    map: sunMap,\r\n    depthWrite: false\r\n  });\r\n  var sun = new THREE.Sprite(sunMaterial);\r\n  sun.scale.set(SUN_RADIUS * 2, SUN_RADIUS * 2, 1);\r\n  celestialSphere.add(sun);\r\n\r\n  var eclipticPlane = new THREE.Mesh(\r\n    new THREE.TorusGeometry(EARTH_DISTANCE, 0.1, 16, 100),\r\n    new THREE.MeshBasicMaterial({\r\n      color: PALETTE.ECLIPTIC,\r\n      side: THREE.DoubleSide\r\n    })\r\n  );\r\n\r\n  eclipticPlane.rotation.x = Math.PI / 2;\r\n  // celestialSphere.add(mesh);\r\n\r\n  var moon = new THREE.Mesh(\r\n    new THREE.SphereGeometry(MOON_RADIUS * 2, 30, 30),\r\n    LambertTextureMaterial(images['moon-day.jpg'], images['moon-night.jpg'])\r\n  );\r\n\r\n  var moonOrbit = new THREE.Mesh(\r\n    new THREE.TorusGeometry(EARTH_DISTANCE, 0.1, 16, 100),\r\n    new THREE.MeshBasicMaterial({\r\n      color: PALETTE.MOON\r\n      // side: THREE.DoubleSide\r\n    })\r\n  );\r\n  moonOrbit.rotation.x = Math.PI / 2;\r\n\r\n  const moonTilt = new THREE.Object3D();\r\n  moonTilt.add(moon);\r\n  moonTilt.add(moonOrbit);\r\n\r\n  moonTilt.rotateOnWorldAxis(new THREE.Vector3(1, 0, 1).normalize(), 5.1 * DEG);\r\n\r\n  eclipticPlane.rotation.x = Math.PI / 2;\r\n\r\n  const ecliptic = new THREE.Object3D();\r\n  ecliptic.add(sun);\r\n  ecliptic.add(moonTilt);\r\n  ecliptic.add(eclipticPlane);\r\n  ecliptic.rotateOnWorldAxis(new THREE.Vector3(0, 0, 1), -EARTH_TILT * DEG);\r\n  celestialSphere.add(ecliptic);\r\n\r\n  var light = new THREE.DirectionalLight(0xffffff, 1);\r\n  var targetObject = new THREE.Object3D();\r\n  targetObject.position.set(0, 0, 0);\r\n  celestialSphere.add(targetObject);\r\n\r\n  light.target = sun;\r\n  light.position.set(0, 0, 0);\r\n  celestialSphere.add(light);\r\n\r\n  const graticule = makeGraticule(EARTH_DISTANCE);\r\n  celestialSphere.add(graticule);\r\n\r\n  const constellations = makeConstellationLines(EARTH_DISTANCE);\r\n  celestialSphere.add(constellations);\r\n\r\n  var equator = new THREE.Mesh(\r\n    new THREE.TorusGeometry(EARTH_DISTANCE, 0.2, 16, 100),\r\n    new THREE.MeshBasicMaterial({\r\n      color: PALETTE.EQUATOR,\r\n      side: THREE.DoubleSide,\r\n      transparent: true,\r\n      opacity: 0.9\r\n    })\r\n  );\r\n  equator.rotation.x = Math.PI / 2;\r\n  celestialSphere.add(equator);\r\n\r\n  scene.add(celestialSphere);\r\n\r\n  const horizon = makeHorizon(EARTH_DISTANCE);\r\n  scene.add(horizon);\r\n\r\n  const northSouth = new THREE.Mesh(\r\n    new THREE.CylinderGeometry(0.1, 0.1, EARTH_DISTANCE * 2, 8),\r\n    new THREE.MeshBasicMaterial({ color: PALETTE.HORIZON })\r\n  );\r\n\r\n  northSouth.rotation.x = Math.PI / 2;\r\n\r\n  scene.add(northSouth);\r\n\r\n  const eastWest = new THREE.Mesh(\r\n    new THREE.CylinderGeometry(0.1, 0.1, EARTH_DISTANCE * 2, 8),\r\n    new THREE.MeshBasicMaterial({ color: PALETTE.HORIZON })\r\n  );\r\n\r\n  eastWest.rotation.z = Math.PI / 2;\r\n\r\n  scene.add(eastWest);\r\n\r\n  const height = 10;\r\n\r\n  const observer = new THREE.Mesh(\r\n    new THREE.CylinderGeometry(0.5, 0.5, height, 8),\r\n    new THREE.MeshBasicMaterial({ color: PALETTE.HORIZON })\r\n  );\r\n\r\n  observer.position.set(0, height / 2, 0);\r\n\r\n  scene.add(observer);\r\n\r\n  import('/js/three/starField.js').then(({ makeStarField }) => {\r\n    const starField = makeStarField(EARTH_DISTANCE, {\r\n      maxSize: 1,\r\n      dot: true,\r\n      additive: true,\r\n      scalePoint: mag => 3 * Math.exp(-0.2 * mag)\r\n    });\r\n    celestialSphere.add(starField);\r\n  });\r\n\r\n  // celestialSphere.add(makeStarField(EARTH_DISTANCE));\r\n\r\n  return {\r\n    update({ positions, hide, location }) {\r\n      const sunLong = positions.Sun.longitude * DEG + Math.PI;\r\n      const moonLong = positions.Moon.longitude * DEG + Math.PI;\r\n\r\n      constellations.visible = !hide.constellations;\r\n      moonOrbit.visible = !hide.orbits;\r\n      eclipticPlane.visible = !hide.orbits;\r\n      graticule.visible = !hide.equator;\r\n      equator.visible = !hide.equator;\r\n      horizon.visible = !hide.horizon;\r\n\r\n      sun.position.x = EARTH_DISTANCE * Math.sin(sunLong);\r\n      sun.position.z = EARTH_DISTANCE * Math.cos(sunLong);\r\n\r\n      celestialSphere.rotation.x = (90 - location.lat) * DEG;\r\n      celestialSphere.rotation.y =\r\n        -location.long * DEG - positions.Earth.rotationAngle * DEG;\r\n\r\n      moon.position.x = EARTH_DISTANCE * Math.sin(moonLong);\r\n      moon.position.z = EARTH_DISTANCE * Math.cos(moonLong);\r\n      moon.lookAt(ground.position);\r\n      moon.rotateY(-Math.PI / 2);\r\n\r\n      renderer.render(scene, camera);\r\n      controls.update();\r\n    },\r\n\r\n    onResize() {\r\n      const BCR1 = container.getBoundingClientRect();\r\n      const WIDTH = BCR1.width;\r\n      const HEIGHT = BCR1.height;\r\n\r\n      camera.aspect = WIDTH / HEIGHT;\r\n      camera.updateProjectionMatrix();\r\n      renderer.setSize(WIDTH, HEIGHT);\r\n    }\r\n  };\r\n}\r\n"]}